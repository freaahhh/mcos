--Database:
/*
BEGIN
   FOR t IN (SELECT table_name FROM user_tables) LOOP
      EXECUTE IMMEDIATE 'DROP TABLE "' || t.table_name || '" CASCADE CONSTRAINTS PURGE';
   END LOOP;
END;
/
PURGE RECYCLEBIN;
*/

-- ==========================================================
-- 1. Create table
-- ==========================================================

-- Creating the CUSTOMER table
CREATE TABLE CUSTOMER (
    CUST_ID NUMBER(11) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    CUST_USERNAME VARCHAR2(50) NOT NULL,
    CUST_PASSWORD VARCHAR2(255) NOT NULL,
    CUST_FIRST_NAME VARCHAR2(100) DEFAULT NULL,
    CUST_LAST_NAME VARCHAR2(100) DEFAULT NULL,
    CUST_CONTACT_NO VARCHAR2(20) DEFAULT NULL,
    CUST_DORM VARCHAR2(50) DEFAULT NULL,
    BANK_NAME VARCHAR2(100) DEFAULT NULL,
    BANK_ACCOUNT VARCHAR2(50) DEFAULT NULL,
    
    CONSTRAINT PK_CUSTOMER PRIMARY KEY (CUST_ID),
    CONSTRAINT UQ_CUST_USERNAME UNIQUE (CUST_USERNAME)
);

-- Creating the CATEGORY table
CREATE TABLE CATEGORY (
    CATEGORY_ID NUMBER(11) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    CATEGORY_DETAILS VARCHAR2(255) NOT NULL,
    CATEGORY_PICT VARCHAR2(255) DEFAULT NULL,
    
    CONSTRAINT PK_CATEGORY PRIMARY KEY (CATEGORY_ID)
);

-- Creating the FEEDBACK_CATEGORY table
CREATE TABLE FEEDBACK_CATEGORY (
    FEEDBACK_CAT_ID NUMBER(11) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    FEEDBACK_CAT_NAME VARCHAR2(100) NOT NULL,
    
    CONSTRAINT PK_FEEDBACK_CATEGORY PRIMARY KEY (FEEDBACK_CAT_ID)
);

-- Creating the STAFF table
CREATE TABLE STAFF (
    STAFF_ID NUMBER(11) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    STAFF_USERNAME VARCHAR2(50) NOT NULL,
    STAFF_PASSWORD VARCHAR2(255) NOT NULL,
    STAFF_FIRST_NAME VARCHAR2(100) DEFAULT NULL,
    STAFF_LAST_NAME VARCHAR2(100) DEFAULT NULL,
    STAFF_CONTACT_NO VARCHAR2(20) DEFAULT NULL,
    STAFF_TYPE VARCHAR2(20) DEFAULT NULL,
    SUPERVISOR_ID NUMBER(11) DEFAULT NULL,
    
    CONSTRAINT PK_STAFF PRIMARY KEY (STAFF_ID),
    CONSTRAINT UQ_STAFF_USERNAME UNIQUE (STAFF_USERNAME),
    -- Recursive Foreign Key (Self-Reference)
    CONSTRAINT FK_STAFF_SUPERVISOR FOREIGN KEY (SUPERVISOR_ID) REFERENCES STAFF (STAFF_ID) ON DELETE SET NULL
);

-- Creating the MENU table
CREATE TABLE MENU (
    MENU_ID NUMBER(11) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    MENU_NAME VARCHAR2(150) NOT NULL,
    MENU_DETAILS VARCHAR2(4000) DEFAULT NULL,
    MENU_PRICE NUMBER(10,2) NOT NULL,
    MENU_AVAILABILITY NUMBER(1) DEFAULT 1,
    MENU_PICT VARCHAR2(255) DEFAULT NULL,
    CATEGORY_ID NUMBER(11) DEFAULT NULL,

    CONSTRAINT PK_MENU PRIMARY KEY (MENU_ID),
    CONSTRAINT FK_MENU_CATEGORY FOREIGN KEY (CATEGORY_ID) REFERENCES CATEGORY(CATEGORY_ID)
);

-- Creating the FULL_TIME table
CREATE TABLE FULL_TIME (
    STAFF_ID NUMBER(11) NOT NULL,
    MONTHLY_SALARY NUMBER(10,2) DEFAULT NULL,

    CONSTRAINT PK_FULL_TIME PRIMARY KEY (STAFF_ID),
    CONSTRAINT FK_FULL_TIME_STAFF FOREIGN KEY (STAFF_ID) REFERENCES STAFF (STAFF_ID) ON DELETE CASCADE
);

-- Creating the PART_TIME table
CREATE TABLE PART_TIME (
    STAFF_ID NUMBER(11) NOT NULL,
    HOURLY_SALARY NUMBER(10,2) DEFAULT NULL,

    CONSTRAINT PK_PART_TIME PRIMARY KEY (STAFF_ID),
    CONSTRAINT FK_PART_TIME_STAFF FOREIGN KEY (STAFF_ID) REFERENCES STAFF (STAFF_ID) ON DELETE CASCADE
);

--Creating the WORK_LOG table
CREATE TABLE WORK_LOG (
    LOG_ID NUMBER(11) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    WORK_DATE DATE DEFAULT NULL,
    HOURS_WORKED NUMBER(5,2) DEFAULT NULL,
    DAY_PRESENT VARCHAR2(20) DEFAULT NULL,
    STAFF_ID NUMBER(11) DEFAULT NULL,

    CONSTRAINT PK_WORK_LOG PRIMARY KEY (LOG_ID),
    CONSTRAINT FK_WORK_LOG_STAFF FOREIGN KEY (STAFF_ID) REFERENCES STAFF(STAFF_ID)
);

--2. Index for STAFF_ID for better performance
CREATE INDEX IDX_WORK_LOG_STAFF_ID ON WORK_LOG (STAFF_ID);

-- Creating the ORDERS table
CREATE TABLE ORDERS (
    ORDER_ID NUMBER(11) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    ORDER_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    DELIVERY_CHARGE NUMBER(10,2) DEFAULT 0.00,
    GRAND_TOTAL NUMBER(10,2) NOT NULL,
    CUST_ID NUMBER(11) DEFAULT NULL,
    STAFF_ID NUMBER(11) DEFAULT NULL,
    
    -- Constraints
    CONSTRAINT PK_ORDERS PRIMARY KEY (ORDER_ID),
    CONSTRAINT FK_ORDERS_CUSTOMER FOREIGN KEY (CUST_ID) REFERENCES CUSTOMER(CUST_ID),
    CONSTRAINT FK_ORDERS_STAFF FOREIGN KEY (STAFF_ID) REFERENCES STAFF(STAFF_ID)
);

-- Creating the CART table
CREATE TABLE CART (
    CART_ID NUMBER(11) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    CUST_ID NUMBER(11),
    MENU_ID NUMBER(11),
    QUANTITY NUMBER(11) NOT NULL,
    
    CONSTRAINT PK_CART PRIMARY KEY (CART_ID),
    CONSTRAINT FK_CART_CUSTOMER FOREIGN KEY (CUST_ID) REFERENCES CUSTOMER(CUST_ID) ON DELETE CASCADE,
    CONSTRAINT FK_CART_MENU FOREIGN KEY (MENU_ID) REFERENCES MENU(MENU_ID) ON DELETE CASCADE
);

-- Creating the DELIVERY table
CREATE TABLE DELIVERY (
    DELIVERY_ID NUMBER(11) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    DELIVERY_TIME TIMESTAMP DEFAULT NULL,
    DELIVERY_DATE DATE DEFAULT NULL,
    DELIVERY_STATUS VARCHAR2(50) DEFAULT NULL,
    ORDER_ID NUMBER(11) DEFAULT NULL,
    STAFF_ID NUMBER(11) DEFAULT NULL,
    
    CONSTRAINT PK_DELIVERY PRIMARY KEY (DELIVERY_ID),
    CONSTRAINT FK_DELIVERY_ORDERS FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ORDER_ID),
    CONSTRAINT FK_DELIVERY_STAFF FOREIGN KEY (STAFF_ID) REFERENCES STAFF(STAFF_ID)
);

-- Creating the FEEDBACK table
CREATE TABLE FEEDBACK (
    FEEDBACK_ID NUMBER(11) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    FEEDBACK VARCHAR2(4000) DEFAULT NULL,
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CUST_ID NUMBER(11) DEFAULT NULL,
    ORDER_ID NUMBER(11) DEFAULT NULL,
    FEEDBACK_CAT_ID NUMBER(11) DEFAULT NULL,
    MENU_ID NUMBER(11) DEFAULT NULL,
    
    CONSTRAINT PK_FEEDBACK PRIMARY KEY (FEEDBACK_ID),
    CONSTRAINT FK_FEEDBACK_CUSTOMER FOREIGN KEY (CUST_ID) REFERENCES CUSTOMER(CUST_ID),
    CONSTRAINT FK_FEEDBACK_CAT FOREIGN KEY (FEEDBACK_CAT_ID) REFERENCES FEEDBACK_CATEGORY(FEEDBACK_CAT_ID),
    CONSTRAINT FK_FEEDBACK_MENU FOREIGN KEY (MENU_ID) REFERENCES MENU(MENU_ID) ON DELETE CASCADE,
    CONSTRAINT FK_FEEDBACK_ORDERS FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ORDER_ID) ON DELETE CASCADE
);

-- Creating the ORDER_MENU table
CREATE TABLE ORDER_MENU (
    ORDER_ID NUMBER(11) NOT NULL,
    MENU_ID NUMBER(11) NOT NULL,
    ORDER_QUANTITY NUMBER(11) NOT NULL,
    SUB_TOTAL NUMBER(10,2) NOT NULL,
    
    CONSTRAINT PK_ORDER_MENU PRIMARY KEY (ORDER_ID, MENU_ID),
    CONSTRAINT FK_ORDER_MENU_ORDERS FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ORDER_ID),
    CONSTRAINT FK_ORDER_MENU_MENU FOREIGN KEY (MENU_ID) REFERENCES MENU(MENU_ID)
);
-- 2. Creating an Index for MENU_ID for performance
CREATE INDEX IDX_ORDER_MENU_MENU_ID ON ORDER_MENU (MENU_ID);

-- Creating the PAYMENT table
CREATE TABLE PAYMENT (
    PAYMENT_ID NUMBER(11) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    AMOUNT_PAID NUMBER(10,2) NOT NULL,
    PAYMENT_METHOD VARCHAR2(50) DEFAULT NULL,
    PAYMENT_STATUS VARCHAR2(50) DEFAULT NULL,
    PAYMENT_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    RECEIPT_FILE VARCHAR2(255) DEFAULT NULL,
    ORDER_ID NUMBER(11) DEFAULT NULL,
    
    CONSTRAINT PK_PAYMENT PRIMARY KEY (PAYMENT_ID),
    CONSTRAINT FK_PAYMENT_ORDERS FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ORDER_ID)
);

--2. Index for Foreign Key
CREATE INDEX IDX_PAYMENT_ORDER_ID ON PAYMENT (ORDER_ID);

-- ==========================================================
-- 2. Insert dummy data
-- ==========================================================

-- CATEGORY
INSERT INTO CATEGORY (CATEGORY_DETAILS, CATEGORY_PICT) VALUES ('Main Course', 'main_course.jpg');
INSERT INTO CATEGORY (CATEGORY_DETAILS, CATEGORY_PICT) VALUES ('Beverages', 'beverages.jpg');
INSERT INTO CATEGORY (CATEGORY_DETAILS, CATEGORY_PICT) VALUES ('Desserts', 'dessert.jpg');

-- FEEDBACK_CATEGORY
INSERT INTO FEEDBACK_CATEGORY (FEEDBACK_CAT_NAME) VALUES ('Food Quality');
INSERT INTO FEEDBACK_CATEGORY (FEEDBACK_CAT_NAME) VALUES ('Delivery Speed');
INSERT INTO FEEDBACK_CATEGORY (FEEDBACK_CAT_NAME) VALUES ('System');

-- CUSTOMER
INSERT INTO CUSTOMER (CUST_USERNAME, CUST_PASSWORD, CUST_FIRST_NAME, CUST_LAST_NAME, CUST_CONTACT_NO, CUST_DORM, BANK_NAME, BANK_ACCOUNT) VALUES ('user', 'password', 'John', 'Doe', '0123456789', 'Dorm A', 'Maybank', '123456789012');
INSERT INTO CUSTOMER (CUST_USERNAME, CUST_PASSWORD, CUST_FIRST_NAME, CUST_LAST_NAME, CUST_CONTACT_NO, CUST_DORM, BANK_NAME, BANK_ACCOUNT) VALUES ('siti', 'siti123', 'Siti', 'Aminah', '0123456789', 'Dorm B', 'CIMB Bank', '1234512345');

-- STAFF
INSERT INTO STAFF (STAFF_USERNAME, STAFF_PASSWORD, STAFF_FIRST_NAME, STAFF_LAST_NAME, STAFF_CONTACT_NO, STAFF_TYPE, SUPERVISOR_ID) VALUES ('superadmin', 'superadmin', 'Michael', 'Scott', '0123456789', 'Full-Time', NULL);
INSERT INTO STAFF (STAFF_USERNAME, STAFF_PASSWORD, STAFF_FIRST_NAME, STAFF_LAST_NAME, STAFF_CONTACT_NO, STAFF_TYPE, SUPERVISOR_ID) VALUES ('farah', 'farah123', 'Farah', 'Adibah', '0189293944', 'Part-Time', 1);
INSERT INTO STAFF (STAFF_USERNAME, STAFF_PASSWORD, STAFF_FIRST_NAME, STAFF_LAST_NAME, STAFF_CONTACT_NO, STAFF_TYPE, SUPERVISOR_ID) VALUES ('yana', 'yana123', 'Nadiratul', 'Liyana', '0172526277', 'Part-Time', 1);
INSERT INTO STAFF (STAFF_USERNAME, STAFF_PASSWORD, STAFF_FIRST_NAME, STAFF_LAST_NAME, STAFF_CONTACT_NO, STAFF_TYPE, SUPERVISOR_ID) VALUES ('ziera', 'ziera123', 'Harisa', 'Haziera', '0162423299', 'Full-Time', 1);
INSERT INTO STAFF (STAFF_USERNAME, STAFF_PASSWORD, STAFF_FIRST_NAME, STAFF_LAST_NAME, STAFF_CONTACT_NO, STAFF_TYPE, SUPERVISOR_ID) VALUES ('nab', 'nab123', 'Nurul', 'Nabilah', '0153839300', 'Full-Time', 1);

-- FULL_TIME
INSERT INTO FULL_TIME (STAFF_ID, MONTHLY_SALARY) VALUES (1, 1500.00);
INSERT INTO FULL_TIME (STAFF_ID, MONTHLY_SALARY) VALUES (4, 1200.00);
INSERT INTO FULL_TIME (STAFF_ID, MONTHLY_SALARY) VALUES (5, 1200.00);
-- PART TIME
INSERT INTO PART_TIME (STAFF_ID, HOURLY_SALARY) VALUES (2, 5.00);
INSERT INTO PART_TIME (STAFF_ID, HOURLY_SALARY) VALUES (3, 5.00);

-- MENU
INSERT INTO MENU (MENU_NAME, MENU_DETAILS, MENU_PRICE, MENU_AVAILABILITY, MENU_PICT, CATEGORY_ID) VALUES ('Nasi Lemak', 'Fragrant rice with sambal', 5.50, 1, 'nasi-lemak.webp', 1);
INSERT INTO MENU (MENU_NAME, MENU_DETAILS, MENU_PRICE, MENU_AVAILABILITY, MENU_PICT, CATEGORY_ID) VALUES ('Iced Tea', 'Refreshing tea with ice', 2.00, 1, 'ice-tea.jpg', 2);
INSERT INTO MENU (MENU_NAME, MENU_DETAILS, MENU_PRICE, MENU_AVAILABILITY, MENU_PICT, CATEGORY_ID) VALUES ('Spicy Popia', 'Popia filled with vegetables', 2.00, 1, 'popia-pedas.jpeg', 3);

-- ORDERS
INSERT INTO ORDERS (ORDER_DATE, DELIVERY_CHARGE, GRAND_TOTAL, CUST_ID, STAFF_ID) VALUES (TO_TIMESTAMP('2025-12-01 12:00:00', 'YYYY-MM-DD HH24:MI:SS'), 2.00, 15.00, 1, 2);
INSERT INTO ORDERS (ORDER_DATE, DELIVERY_CHARGE, GRAND_TOTAL, CUST_ID, STAFF_ID) VALUES (TO_TIMESTAMP('2025-12-02 14:00:00', 'YYYY-MM-DD HH24:MI:SS'), 2.00, 6.00, 2, 3);
INSERT INTO ORDERS (ORDER_DATE, DELIVERY_CHARGE, GRAND_TOTAL, CUST_ID, STAFF_ID) VALUES (TO_TIMESTAMP('2025-12-04 10:40:23', 'YYYY-MM-DD HH24:MI:SS'), 2.00, 4.00, 1, 5);
INSERT INTO ORDERS (ORDER_DATE, DELIVERY_CHARGE, GRAND_TOTAL, CUST_ID, STAFF_ID) VALUES (TO_TIMESTAMP('2025-12-05 11:12:23', 'YYYY-MM-DD HH24:MI:SS'), 2.00, 4.00, 2, 2);

-- ORDER_MENU
INSERT INTO ORDER_MENU (ORDER_ID, MENU_ID, ORDER_QUANTITY, SUB_TOTAL) VALUES (1, 1, 2, 11.00);
INSERT INTO ORDER_MENU (ORDER_ID, MENU_ID, ORDER_QUANTITY, SUB_TOTAL) VALUES (1, 2, 1, 2.00);
INSERT INTO ORDER_MENU (ORDER_ID, MENU_ID, ORDER_QUANTITY, SUB_TOTAL) VALUES (2, 2, 2, 4.00);
INSERT INTO ORDER_MENU (ORDER_ID, MENU_ID, ORDER_QUANTITY, SUB_TOTAL) VALUES (3, 3, 1, 2.00);
INSERT INTO ORDER_MENU (ORDER_ID, MENU_ID, ORDER_QUANTITY, SUB_TOTAL) VALUES (4, 2, 1, 2.00);

-- DELIVERY
INSERT INTO DELIVERY (DELIVERY_TIME, DELIVERY_DATE, DELIVERY_STATUS, ORDER_ID, STAFF_ID) VALUES (TO_TIMESTAMP('12:30:00', 'HH24:MI:SS'), TO_DATE('2025-12-01', 'YYYY-MM-DD'), 'Delivered', 1, 2);
INSERT INTO DELIVERY (DELIVERY_TIME, DELIVERY_DATE, DELIVERY_STATUS, ORDER_ID, STAFF_ID) VALUES (TO_TIMESTAMP('14:30:00', 'HH24:MI:SS'), TO_DATE('2025-12-02', 'YYYY-MM-DD'), 'Delivered', 2, 3);
INSERT INTO DELIVERY (DELIVERY_TIME, DELIVERY_DATE, DELIVERY_STATUS, ORDER_ID, STAFF_ID) VALUES (TO_TIMESTAMP('11:00:00', 'HH24:MI:SS'), TO_DATE('2025-12-04', 'YYYY-MM-DD'), 'Cancelled', 3, NULL);
INSERT INTO DELIVERY (DELIVERY_TIME, DELIVERY_DATE, DELIVERY_STATUS, ORDER_ID, STAFF_ID) VALUES (TO_TIMESTAMP('11:30:00', 'HH24:MI:SS'), TO_DATE('2025-12-05', 'YYYY-MM-DD'), 'Cancelled', 4, NULL);

-- FEEDBACK
INSERT INTO FEEDBACK (FEEDBACK, CREATED_AT, CUST_ID, ORDER_ID, FEEDBACK_CAT_ID, MENU_ID) VALUES ('It was nice. Highly recommended!', TO_TIMESTAMP('2025-12-01 12:35:00', 'YYYY-MM-DD HH24:MI:SS'), 1, 1, 1, 3);
INSERT INTO FEEDBACK (FEEDBACK, CREATED_AT, CUST_ID, ORDER_ID, FEEDBACK_CAT_ID, MENU_ID) VALUES ('The system work perfectly!', TO_TIMESTAMP('2025-12-02 14:35:00', 'YYYY-MM-DD HH24:MI:SS'), 1, 2, 3, 2);

--PAYMENT
INSERT INTO PAYMENT (AMOUNT_PAID, PAYMENT_METHOD, PAYMENT_STATUS, PAYMENT_DATE, RECEIPT_FILE, ORDER_ID) VALUES (15.00, 'Maybank', 'Completed', TO_TIMESTAMP('2025-12-01 12:25:00', 'YYYY-MM-DD HH24:MI:SS'), 'receipt-1.jpg', 1);
INSERT INTO PAYMENT (AMOUNT_PAID, PAYMENT_METHOD, PAYMENT_STATUS, PAYMENT_DATE, RECEIPT_FILE, ORDER_ID) VALUES (6.00, 'CIMB Bank', 'Completed', TO_TIMESTAMP('2025-12-02 14:20:00', 'YYYY-MM-DD HH24:MI:SS'), 'receipt-2.jpg', 2);
INSERT INTO PAYMENT (AMOUNT_PAID, PAYMENT_METHOD, PAYMENT_STATUS, PAYMENT_DATE, RECEIPT_FILE, ORDER_ID) VALUES (4.00, 'Maybank', 'Failed', TO_TIMESTAMP('2025-12-04 10:50:00', 'YYYY-MM-DD HH24:MI:SS'), 'receipt-3.jpg', 3);
INSERT INTO PAYMENT (AMOUNT_PAID, PAYMENT_METHOD, PAYMENT_STATUS, PAYMENT_DATE, RECEIPT_FILE, ORDER_ID) VALUES (4.00, 'CIMB Bank', 'Failed', TO_TIMESTAMP('2025-12-05 11:25:00', 'YYYY-MM-DD HH24:MI:SS'), 'receipt-4.jpg', 4);

-- ==========================================================
-- Save
-- ==========================================================
COMMIT;